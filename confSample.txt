worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    server {
        listen 80;
        server_name localhost;

        # 1. Global Root (Must match your actual folder)
        root "C:/Users/Rehan/Desktop/backup_coding/Projects/deployments";

        # 2. Debug Logs
        error_log "C:/nginx/logs/debug_error.log" debug;

        # 3. Dynamic Project Routing (The "Try Files" Method)
        # logic: Capture 'project-1' as $proj, and the rest as $asset
        location ~ ^/(?<proj>project-[0-9]+)(?<asset>/.*)?$ {
            
            # Enable directory listing so you see errors instead of 403
            autoindex on;
            index index.html;

            # MAGIC LINE:
            # 1. Look for file at: /project-1/current/style.css
            # 2. Look for dir at:  /project-1/current/style.css/
            # 3. Look for index:   /project-1/current/index.html
            try_files /$proj/current$asset /$proj/current$asset/index.html =404;
        }

        location = /favicon.ico { return 204; }
    }
}